<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>NCVET Skilling Assistant — Demo</title>

  <!-- Bootstrap & icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <!-- model-viewer for 3D teacher (optional) -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <!-- Chart.js & html2pdf -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

  <style>
    :root{--primary:#3f51b5;--secondary:#ff4081;--light:#f5f5f5;--dark:#212121}
    body{font-family:Segoe UI,Inter,system-ui,Arial;background:#f8f9fa;color:#222}
    .navbar{background:var(--primary)}
    .hero-section{background:linear-gradient(rgba(63,81,181,.82),rgba(63,81,181,.92)),url('https://images.unsplash.com/photo-1523240795612-9a054b0db644?auto=format&fit=crop&w=1500');background-size:cover;color:#fff;padding:4rem 0;margin-bottom:1.6rem}
    .card{border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.06);transition:transform .18s}
    .card:hover{transform:translateY(-6px)}
    .btn-primary{background:var(--primary);border-color:var(--primary)}
    .pathway-card{border-left:4px solid var(--primary)}
    footer{background:var(--dark);color:#fff;padding:2rem 0;margin-top:2.6rem}
    #loader{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#fff;z-index:9999;flex-direction:column}
    .language-selector{position:absolute;top:14px;right:14px;z-index:1000}
    .auth-only{display:none}
    .profile-pic{width:100px;height:100px;object-fit:cover;border-radius:50%}
    .mentor-chat{height:220px;overflow:auto;background:#fbfbfd;border-radius:8px;padding:12px}
    .mentor-input{resize:none}
    .small-muted{font-size:.9rem;color:#666}
    /* toast position */
    .toast-container{position:fixed;top:18px;right:18px;z-index:2000}
  </style>
</head>
<body>

  <!-- Loader -->
  <div id="loader">
    <div class="spinner-border text-primary" style="width:4rem;height:4rem" role="status"></div>
    <div class="mt-3"><strong>Initializing NCVET Skilling Assistant (demo)...</strong></div>
    <small class="text-muted mt-2">Simulating AI & labour-market connectors...</small>
  </div>

  <!-- Toast container -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
      <a class="navbar-brand" href="#"><i class="fas fa-graduation-cap me-2"></i>NCVET Skilling Assistant (Demo)</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu"><span class="navbar-toggler-icon"></span></button>
      <div class="collapse navbar-collapse" id="navMenu">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link active" href="#/">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="#/about">About</a></li>
          <li class="nav-item"><a class="nav-link" href="#/dashboard">Dashboard</a></li>
          <li class="nav-item"><a class="nav-link" href="#/login">Login</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main -->
  <main class="container my-4" id="appRoot">
    <!-- (same content as your page) -->
    <!-- Landing / Hero -->
    <section id="landing" class="hero-section text-center">
      <div class="container">
        <h1 class="display-5 fw-bold mb-3">Personalized Skilling Pathways</h1>
        <p class="lead mb-4">AI-powered career guidance aligned with NSQF and industry demand — demo prototype</p>
        <div class="d-flex justify-content-center gap-2">
          <button id="getStartedBtn" class="btn btn-light btn-lg px-4"><i class="fas fa-rocket me-2"></i>Get Started</button>
          <a href="#/about" class="btn btn-outline-light btn-lg px-4">About</a>
        </div>
      </div>
    </section>

    <!-- About -->
    <section id="about" style="display:none">
      <div class="row align-items-center">
        <div class="col-md-6">
          <div class="card p-4 mb-3">
            <h4>About this Demo</h4>
            <p class="small-muted">This is a working client-only prototype for the NCVET Skilling Assistant. It demonstrates onboarding, profile picture upload, AI-like recommendations (rule-based for demo), a 3D teacher, a virtual mentor chat, and a small labour-market forecast visualization.</p>
            <ul>
              <li>Inclusive: works for any learner background</li>
              <li>NSQF anchored (mock levels)</li>
              <li>Server-backed persistence & image uploads</li>
            </ul>
            <button class="btn btn-primary" id="aboutGetStarted">Let's get started</button>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card p-3">
            <h5>Why this matters</h5>
            <p class="small-muted">Personalized learning paths reduce skill mismatch and increase employability. Judges love a small working demo that simulates the real ML/workflow.</p>
            <img src="https://images.unsplash.com/photo-1523240795612-9a054b0db644?auto=format&fit=crop&w=1200" class="img-fluid rounded" alt="">
          </div>
        </div>
      </div>
    </section>

    <!-- Auth / Signup -->
    <section id="auth" style="display:none">
      <div class="row justify-content-center">
        <div class="col-md-8">
          <div class="card p-3">
            <ul class="nav nav-tabs mb-3" id="authTabs">
              <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#signupTab">Sign Up</a></li>
              <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#loginTab">Login</a></li>
            </ul>

            <div class="tab-content">
              <div class="tab-pane show active" id="signupTab">
                <form id="signupForm" enctype="multipart/form-data">
                  <div class="row">
                    <div class="col-md-6 mb-2">
                      <label class="form-label">Full name</label>
                      <input id="signup_name" class="form-control" required/>
                    </div>
                    <div class="col-md-6 mb-2">
                      <label class="form-label">Email</label>
                      <input id="signup_email" type="email" class="form-control" required/>
                    </div>
                    <div class="col-md-4 mb-2">
                      <label class="form-label">Education</label>
                      <select id="signup_edu" class="form-select">
                        <option>8th Pass</option><option>10th Pass</option><option>12th Pass</option><option>Diploma</option><option>Bachelor's Degree</option><option>Master's Degree</option>
                      </select>
                    </div>
                    <div class="col-md-4 mb-2">
                      <label class="form-label">Career Aspiration</label>
                      <input id="signup_asp" class="form-control" placeholder="e.g., Electronics Technician"/>
                    </div>
                    <div class="col-md-4 mb-2">
                      <label class="form-label">Learning Pace</label>
                      <select id="signup_pace" class="form-select">
                        <option>Self-paced</option><option>Part-time</option><option>Full-time</option>
                      </select>
                    </div>

                    <div class="col-md-8 mb-2">
                      <label class="form-label">Select current skills (comma separated)</label>
                      <input id="signup_skills" class="form-control" placeholder="Basic Computing, Electronics"/>
                      <div class="form-text small-muted">For demo simplicity, list skills separated by commas.</div>
                    </div>

                    <div class="col-md-4 mb-2 text-center">
                      <label class="form-label d-block">Upload profile picture</label>
                      <input id="profilePicInput" type="file" accept="image/*" class="form-control mb-2" />
                      <img id="profilePicPreview" class="profile-pic" src="https://ui-avatars.com/api/?name=Learner&background=3f51b5&color=fff" alt="preview"/>
                    </div>
                  </div>

                  <div class="mt-3 d-flex justify-content-end gap-2">
                    <button type="button" id="signup_cancel" class="btn btn-outline-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Profile & Get Recommendations</button>
                  </div>
                </form>
              </div>

              <div class="tab-pane" id="loginTab">
                <form id="loginForm">
                  <div class="mb-2">
                    <label class="form-label">Email</label>
                    <input id="login_email" class="form-control" />
                  </div>
                  <div class="d-flex justify-content-end gap-2">
                    <button type="button" id="login_cancel" class="btn btn-outline-secondary">Back</button>
                    <button type="submit" id="login_btn" class="btn btn-primary">Login</button>
                  </div>
                </form>
                <div class="mt-3 small text-muted">Demo login checks server first then localStorage.</div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </section>

    <!-- Dashboard -->
    <section id="dashboard" style="display:none">
      <div class="row">
        <div class="col-md-4">
          <div class="card p-3 mb-3">
            <div class="text-center">
              <img id="sidebarPic" class="profile-pic mb-2" src="https://ui-avatars.com/api/?name=Learner&background=3f51b5&color=fff" alt="profile">
              <h5 id="sidebarName">Learner Name</h5>
              <p id="sidebarLocation" class="small-muted">Location: -</p>
            </div>

            <hr/>
            <div>
              <h6>Education</h6>
              <div id="sidebarEdu" class="small-muted">-</div>
            </div>
            <div class="mt-2">
              <h6>Skills</h6>
              <div id="sidebarSkills"></div>
            </div>
            <div class="mt-3">
              <h6>Current Path</h6>
              <div id="sidebarPath" class="small-muted">Not started</div>
            </div>
            <div class="mt-3">
              <button id="exportPdf" class="btn btn-outline-primary w-100"><i class="fas fa-file-export me-2"></i>Export Pathway (PDF)</button>
            </div>
          </div>

          <div class="card p-3">
            <h6 class="mb-2">Virtual AI Mentor</h6>
            <div class="mentor-chat" id="mentorChat"></div>
            <div class="mt-2 d-flex gap-2">
              <input id="mentorInput" class="form-control mentor-input" placeholder="Ask mentor (e.g., 'What job fits me?')" />
              <button id="askMentorBtn" class="btn btn-primary">Ask</button>
            </div>
          </div>
        </div>

        <div class="col-md-8">
          <div class="card p-3 mb-3">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h5 class="mb-1">Recommended Learning Pathways</h5>
                <small class="small-muted">Generated from your profile (demo rules-based)</small>
              </div>
              <div><span id="recoBadge" class="badge bg-success">Mock AI</span></div>
            </div>

            <div id="recommendation-list" class="mt-3"></div>
          </div>

          <div class="card p-3 mb-3">
            <h6>3D AI Model Teacher (interactive)</h6>
            <div class="mb-2 small-muted">Tap to rotate or open in AR (supported devices).</div>
            <model-viewer src="https://modelviewer.dev/shared-assets/models/Astronaut.glb"
                          alt="3D Teacher"
                          camera-controls
                          auto-rotate
                          ar
                          style="width:100%;height:320px;border-radius:8px;background:#000"></model-viewer>
            <div class="mt-2 d-flex gap-2">
              <button id="teacherTip" class="btn btn-outline-primary">Ask Teacher a Tip</button>
              <button id="teacherAnimate" class="btn btn-outline-secondary">Animate</button>
            </div>
          </div>

          <div class="card p-3">
            <div class="d-flex justify-content-between">
              <h6>Labor Market Forecast Engine</h6>
              <div class="small-muted">Adjust forecast confidence</div>
            </div>
            <canvas id="lmiChart" height="140"></canvas>
            <div class="mt-2 d-flex align-items-center gap-2">
              <label class="mb-0 small-muted">Confidence</label>
              <input id="confSlider" type="range" min="0" max="100" value="70" class="form-range" style="width:220px"/>
              <span id="confVal" class="small-muted">70%</span>
            </div>
          </div>

        </div>
      </div>
    </section>

  </main>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-md-4">
          <h5>NCVET Skilling Assistant</h5>
          <p class="small-muted">Demo prototype — shows core flows for the SIH internal hackathon.</p>
        </div>
        <div class="col-md-4">
          <h6>Contact</h6>
          <div class="small-muted">support@ncvet.gov.in • 1800-123-4567</div>
        </div>
        <div class="col-md-4 text-md-end">
          <small>© 2025 Demo</small>
        </div>
      </div>
    </div>
  </footer>

  <!-- Bootstrap Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- App JS -->
  <script>
    const API = 'http://localhost:4000'; // backend base - change if needed

    /*********************
     * Toast helper
     *********************/
    function showToast(message, type='info', timeout=3500){
      const container = document.getElementById('toastContainer');
      const id = 't'+Date.now();
      const toastHtml = document.createElement('div');
      toastHtml.className = 'toast align-items-center text-bg-light border-0';
      toastHtml.id = id;
      toastHtml.style.minWidth = '220px';
      toastHtml.innerHTML = `
        <div class="d-flex">
          <div class="toast-body">${message}</div>
          <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
      `;
      container.appendChild(toastHtml);
      const t = new bootstrap.Toast(toastHtml, { delay: timeout });
      t.show();
      setTimeout(()=> { try{ container.removeChild(toastHtml);}catch(e){} }, timeout+600);
    }

    /*********************
     * Persistence helpers
     *********************/
    function saveProfileLocal(profile) { localStorage.setItem('sp_user', JSON.stringify(profile)); }
    function getProfileLocal() { try { return JSON.parse(localStorage.getItem('sp_user')||'null'); } catch(e){ return null; } }
    function clearProfileLocal(){ localStorage.removeItem('sp_user'); }

    /*********************
     * Routing & UI show/hide
     *********************/
    function showSection(id){ ['landing','about','auth','dashboard'].forEach(s => {
      const el = document.getElementById(s);
      if(!el) return;
      el.style.display = (s===id) ? '' : 'none';
    });}
    function route(){
      const hash = location.hash || '#/';
      if(hash.startsWith('#/about')) showSection('about');
      else if(hash.startsWith('#/dashboard')) { showSection('dashboard'); loadDashboard(); }
      else if(hash.startsWith('#/login')) showSection('auth');
      else showSection('landing');
    }
    window.addEventListener('hashchange', route);

    /*********************
     * Loader simulation
     *********************/
    window.addEventListener('load', ()=> {
      setTimeout(()=> {
        document.getElementById('loader').style.display = 'none';
        const p = getProfileLocal();
        if(p) { location.hash = '#/dashboard'; } else { route(); }
      }, 700);
    });

    /*********************
     * Signup (POST to server; fallback local)
     *********************/
    const signupForm = document.getElementById('signupForm');
    const picInput = document.getElementById('profilePicInput');

    // preview
    picInput.addEventListener('change', function(e){
      const f = e.target.files[0]; if(!f) return;
      const r = new FileReader(); r.onload = () => document.getElementById('profilePicPreview').src = r.result; r.readAsDataURL(f);
    });

    signupForm.addEventListener('submit', async function(e){
      e.preventDefault();
      const profile = {
        name: document.getElementById('signup_name').value || '',
        email: document.getElementById('signup_email').value || '',
        education: document.getElementById('signup_edu').value || '',
        aspiration: document.getElementById('signup_asp').value || '',
        pace: document.getElementById('signup_pace').value || '',
        skills: (document.getElementById('signup_skills').value || '').split(',').map(s=>s.trim()).filter(Boolean),
        pic: document.getElementById('profilePicPreview').src || ''
      };

      // try server upload
      try {
        const fd = new FormData();
        fd.append('name', profile.name);
        fd.append('email', profile.email);
        fd.append('education', profile.education);
        fd.append('aspiration', profile.aspiration);
        fd.append('skills', (profile.skills||[]).join(','));
        if(picInput.files && picInput.files[0]) fd.append('profilePic', picInput.files[0]);

        const res = await fetch(API + '/api/signup', { method: 'POST', body: fd });
        if(res.ok){
          const data = await res.json();
          if(data.ok && data.profile){
            saveProfileLocal(data.profile);
            showToast('Profile saved to server and locally', 'success');
            location.hash = '#/dashboard';
            loadDashboard();
            return;
          }
        }
        // fallback to local if non-200
        const text = await res.text();
        console.warn('server response', res.status, text);
        showToast('Server returned error — saving locally', 'warning');
      } catch(err){
        console.warn('server error', err);
        showToast('Could not reach server — saving locally', 'warning');
      }

      // fallback: save local
      saveProfileLocal(profile);
      showToast('Profile saved locally', 'success');
      location.hash = '#/dashboard';
      loadDashboard();
    });

    // login: try server first, else local
    const loginForm = document.getElementById('loginForm');
    loginForm.addEventListener('submit', async function(e){
      e.preventDefault();
      const email = document.getElementById('login_email').value || '';
      if(!email){ showToast('Enter email', 'warning'); return; }

      // try server
      try {
        const res = await fetch(API + '/api/profile?email=' + encodeURIComponent(email));
        if(res.ok){
          const data = await res.json();
          if(data.ok && data.profile){
            saveProfileLocal(data.profile);
            showToast('Logged in (server profile)', 'success');
            location.hash = '#/dashboard';
            loadDashboard();
            return;
          }
        }
      } catch(err){ /* server unreachable */ }

      // fallback to local
      const local = getProfileLocal();
      if(local && local.email === email){
        showToast('Logged in (local profile)', 'success');
        location.hash = '#/dashboard';
        loadDashboard();
        return;
      }

      showToast('No profile found. Please sign up first.', 'danger');
    });

    document.getElementById('signup_cancel').addEventListener('click', ()=> { location.hash = '#/'; });
    document.getElementById('login_cancel').addEventListener('click', ()=> { location.hash = '#/'; });
    document.getElementById('getStartedBtn').addEventListener('click', ()=> location.hash = '#/login');
    document.getElementById('aboutGetStarted').addEventListener('click', ()=> location.hash = '#/login');

    /*********************
     * Dashboard rendering
     *********************/
    function populateSidebar(profile){
      document.getElementById('sidebarName').innerText = profile.name || 'Learner';
      document.getElementById('sidebarPic').src = profile.pic ? (profile.pic.startsWith('/') ? (API + profile.pic) : profile.pic) : 'https://ui-avatars.com/api/?name=Learner&background=3f51b5&color=fff';
      document.getElementById('sidebarEdu').innerText = profile.education || '-';
      document.getElementById('sidebarLocation').innerText = 'Location: India (demo)';
      document.getElementById('sidebarSkills').innerHTML = (profile.skills||[]).map(s => `<span class="badge bg-primary me-1 mb-1">${s}</span>`).join('');
      document.getElementById('sidebarPath').innerText = profile.currentPath || 'Not started';
    }

    function generateMockRecommendations(profile){
      const mapping = [
        {predicate: s=> s.includes('electronics'), pathway: {title:'Electronics Technician', nsqf:4, months:6, desc:'Assembly, testing, maintenance', courses:['Basic Electronics Theory','Circuit Assembly Techniques','Measurement Instruments']}},
        {predicate: s=> s.includes('computing')||s.includes('it'), pathway: {title:'IT Support Specialist', nsqf:4, months:5, desc:'Helpdesk, hardware & software support', courses:['PC Basics','OS & Networking','Troubleshooting']}},
        {predicate: s=> s.includes('healthcare'), pathway: {title:'Healthcare Assistant', nsqf:4, months:4, desc:'Patient care basics', courses:['First Aid','Caregiving Basics','Sanitation']}}
      ];
      const recs = [];
      const txt = ((profile.aspiration||'') + ' ' + (profile.skills||[]).join(' ')).toLowerCase();
      mapping.forEach(m => {
        if(m.predicate(txt) || m.predicate((profile.skills||[]).join(' '))) recs.push(m.pathway);
      });
      if(recs.length === 0){
        recs.push({title:'General IT Support', nsqf:4, months:6, desc:'Entry IT support roles', courses:['Basic Computing','Networking Basics','Customer Service']});
      }
      return recs;
    }

    function renderRecommendations(recs){
      const container = document.getElementById('recommendation-list');
      container.innerHTML = '';
      recs.forEach(r => {
        const card = document.createElement('div');
        card.className = 'card mb-3 pathway-card';
        card.innerHTML = `
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h5>${r.title}</h5>
                <p class="text-muted mb-1">NSQF Level: ${r.nsqf} | ${r.months} months</p>
                <p class="small-muted">${r.desc}</p>
              </div>
              <div class="text-end">
                <button class="btn btn-primary start-path">Start This Pathway</button>
                <button class="btn btn-outline-secondary mt-2 view-details">View</button>
              </div>
            </div>
            <div class="mt-3 small-muted"><strong>Courses:</strong> ${r.courses.join(', ')}</div>
          </div>`;
        card.querySelector('.start-path').addEventListener('click', ()=> {
          const p = getProfileLocal() || {};
          p.currentPath = r.title;
          p.progress = 0;
          saveProfileLocal(p);
          showToast('Path started: ' + r.title, 'success');
          populateSidebar(p);
        });
        card.querySelector('.view-details').addEventListener('click', ()=> {
          showToast('Course list opened (demo)', 'info'); alert('Path: ' + r.title + '\nCourses: ' + r.courses.join(', '));
        });
        container.appendChild(card);
      });
    }

    function loadDashboard(){
      showSection('dashboard');
      const profile = getProfileLocal();
      if(!profile){
        showToast('No profile found. Please sign up.', 'warning');
        location.hash = '#/login';
        return;
      }
      populateSidebar(profile);
      const recs = generateMockRecommendations(profile);
      renderRecommendations(recs);
    }

    /*********************
     * Mentor Chat
     *********************/
    function mentorReply(input){
      const p = getProfileLocal() || {};
      const lower = input.toLowerCase();
      if(lower.includes('job') || lower.includes('work')) return `Based on your profile (${p.aspiration || 'not specified'}), suitable entry roles: ${generateMockRecommendations(p).map(x=>x.title).slice(0,3).join(', ')}. Consider the first micro-course to start.`;
      if(lower.includes('start') || lower.includes('path')) return `To start a pathway, click "Start This Pathway" on any recommended card.`;
      if(lower.includes('salary') || lower.includes('pay')) return `Estimated starting salary (demo): ₹15,000 - ₹25,000 / month depending on skill level and city.`;
      return `Great question! For '${input}', I'd recommend improving: ${(p.skills||[]).slice(0,3).join(', ') || 'basic computing, communication' }. (Demo mentor)`;
    }

    document.getElementById('askMentorBtn').addEventListener('click', ()=> {
      const input = document.getElementById('mentorInput').value || 'Hello';
      const chat = document.getElementById('mentorChat');
      const me = document.createElement('div'); me.innerHTML = `<div class="text-end"><small class="text-muted">You</small><div class="p-2 bg-white d-inline-block rounded">${input}</div></div>`; chat.appendChild(me);
      setTimeout(()=> {
        const r = mentorReply(input);
        const bot = document.createElement('div'); bot.innerHTML = `<div class="mt-2"><small class="text-muted">Mentor</small><div class="p-2 bg-light rounded">${r}</div></div>`; chat.appendChild(bot);
        chat.scrollTop = chat.scrollHeight;
      }, 600);
      document.getElementById('mentorInput').value = '';
    });

    /*********************
     * 3D Teacher & LMI Chart & Export
     *********************/
    document.getElementById('teacherTip').addEventListener('click', ()=> showToast('Teacher tip: Practice circuit assembly 20 hours (demo)', 'info'));
    document.getElementById('teacherAnimate').addEventListener('click', ()=> {
      const mv = document.querySelector('model-viewer'); if(mv){ mv.autoRotate = !mv.autoRotate; showToast('Toggled rotation', 'info'); }
    });

    const ctx = document.getElementById('lmiChart').getContext('2d');
    const baseData = {
      labels: ['Now','6m','12m','18m','24m'],
      datasets: [
        { label:'Electronics Technicians', data:[85,88,92,95,97], borderColor:'#f97316', fill:false, tension:.3, borderWidth:2 },
        { label:'Telecom Technicians', data:[60,62,65,66,68], borderColor:'#3b82f6', fill:false, tension:.3, borderWidth:2 },
        { label:'Industrial Electronics', data:[78,80,85,88,91], borderColor:'#10b981', fill:false, tension:.3, borderWidth:2 }
      ]
    };
    const lmiChart = new Chart(ctx, { type:'line', data:baseData, options:{responsive:true,plugins:{legend:{position:'top'}}}});

    document.getElementById('confSlider').addEventListener('input', (e)=> {
      const v = +e.target.value;
      document.getElementById('confVal').innerText = v+'%';
      lmiChart.data.datasets.forEach((d,i)=>{ d.data = baseData.datasets[i].data.map(x=> Math.round(x * (0.9 + v/100*0.2))); });
      lmiChart.update();
    });

    document.getElementById('exportPdf').addEventListener('click', ()=> {
      const profile = getProfileLocal();
      if(!profile){ showToast('No profile to export', 'warning'); return; }
      const el = document.createElement('div');
      el.innerHTML = `<div style="font-family:Arial;padding:12px"><h2>Learning Pathway Export</h2><p><strong>Name:</strong> ${profile.name}</p><p><strong>Email:</strong> ${profile.email}</p><p><strong>Current Path:</strong> ${profile.currentPath || 'Not started'}</p><p><strong>Skills:</strong> ${(profile.skills||[]).join(', ')}</p><p>This is a demo export (client-only)</p></div>`;
      html2pdf().set({ margin:10, filename: 'pathway_export.pdf' }).from(el).save();
    });

    /*********************
     * Init route & small niceties
     *********************/
    route();
    document.getElementById('mentorInput').addEventListener('keypress', (e)=>{ if(e.key === 'Enter'){ e.preventDefault(); document.getElementById('askMentorBtn').click(); } });

  </script>
</body>
</html>